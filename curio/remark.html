<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>文物评论</title><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="resource/css/common.css" />
    <link rel="stylesheet" href="resource/css/remark.css" />
    <script src="resource/js/jquery.js" ></script>
    <script src="resource/js/config.js" ></script>
    <script src="resource/js/layer.js" ></script>
</head>
<body>
<div id="main">
    <div class="top">
        <i class="icon back _back"></i>
    </div>
    <div class="remark">
        <p class="title">鉴赏文物评论 (6)</p>
        <p class="tip">加载更多</p>
        <div class="item">
            <p class="head"><img src="resource/img/sync_note/head1.png"/></p>
            <p class="user_content">
                <span class="name">晃晃梨</span>
                <span class="content">送给我就要</span>
            </p>
            <!--been类为已点赞的样式-->
            <p class="admire been">
                <span class="num">1234</span>
                <i class="icon admire"></i>
            </p>
        </div>
        <!---------------------------------------------------------------------------------------------->
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要，重要的事情说说三遍</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要，重要的事情说说三遍</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要，重要的事情说说三遍</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要，重要的事情说说三遍</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要，重要的事情说说三遍</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <div class="item"><p class="head"><img src="resource/img/sync_note/head1.png"/></p> <p class="user_content"> <span class="name">晃晃梨</span> <span class="content">送给我就要送给我就要送给我就要，重要的事情说说三遍送给我就要送给我就要送给我就要，重要的事情说说三遍送给我就要送给我就要送给我就要，重要的事情说说三遍送给我就要送给我就要送给我就要，重要的事情说说三遍送给我就要送给我就要送给我就要，重要的事情说说三遍送给我就要送给我就要送给我就要，重要的事情说说三遍</span> </p> <p class="admire"> <span class="num">1234</span> <i class="icon admire"></i> </p> </div>
        <!---------------------------------------------------------------------------------------------->
    </div>
    <form class="input">
        <input />
        <span class="_btn" onclick="this.parentNode.submit();">发表</span>
    </form>

    <script>
        !function(){
            var be_bottom  = false;
            window.addEventListener("scroll", function(){
                var scroll_bottom = document.documentElement.offsetHeight - window.scrollY - window.innerHeight;
                if(dy < 0){
                    window.scrollTo(0, window.scrollY - dy);
                }
                dy += scroll_bottom;
                if(dy > 0){
                    dy = 0;
                }

                if(dy <= 0){
                    be_bottom = true;
                }else{
                    be_bottom = false;
                }
            });

            //到底以后继续向上拖拽
            var el_remark = $(".remark");
            var dy = 0;
            isun.drag_measure(el_remark, function(d){
                if(be_bottom){
                    dy += d[1];
                    var dy_rem = dy * 750 / window.innerHeight / 100;
                    el_remark.css("top", dy_rem * 0.3 + "rem");
                }else{
//                    dy = 0;
                }
            }, function(last_d){
                var dy_rem = dy * 750 / window.innerHeight / 100;
                if(dy_rem <= -2){
                    load_more();
                }
                el_remark.css("top", "0");
                dy = 0;
            });

            $(".remark .tip").on("click", load_more);

            function load_more(){
                var load_index = layer.load(2, {time: 30000});
                //TODO 查询新的评论并添加
                $.ajax({
                    url: "",
                    type: "get",
                    data: {},
                    success: function(data){
                        var items = el_remark.children(".item");
                        if(items.length > 0){
                            var template = items.last();
                            //TODO 克隆模板，修改数据，添加
                            el_remark.append(template.clone(true, true));
                            ///////////////////////////////////////////////////////////
                        }

                        //TODO 开发使用
                        setTimeout(function(){
                            layer.close(load_index);
                        }, 1000);
                        ///////////////////////////////////////////////////

                        //layer.close(load_index);
                    },
                    error: function(xhr, a, b){

                    }
                });
            }
        }();

        $(".user_content .content").on("click", function(){
            this.style["max-height"] = "none";
        });
    </script>
</div>
</body>
</html>